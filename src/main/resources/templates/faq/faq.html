<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>FAQ</title>
	<script src="https://code.jquery.com/jquery-latest.js"></script>
	<script>
		$(document).ready(function () {
			$(".faq").click(function () {
				// FAQ를 클릭할 때마다 해당 데이터 가져오기
				let answer = $(this).data("answer"); // 클릭된 FAQ 항목의 데이터 속성 중 "answer" 값을 가져와서 answer 변수에 저장, 이 데이터 속성은 FAQ 항목의 내용을 나타낸다

				// 해당 FAQ에 대한 표시 영역 선택
				let showId = $(this).data("show-id"); // 클릭된 FAQ 항목의 데이터 속성 중 "show-id" 값을 가져와서 showId 변수에 저장, 이 데이터 속성은 FAQ 내용이 표시될 영역의 HTML 요소의 ID를 나타낸다
				let showArea = $("#" + showId); // 위에서 가져온 showId 값을 사용하여 FAQ 내용이 표시될 영역을 선택, jQuery의 $() 함수를 사용하여 해당 ID를 가진 HTML 요소를 선택

				showArea.empty();

				$.ajax({
					type: "get",
					url: "detailfaq", // Ajax 요청을 보낼 URL을 지정
					data: {"detail": answer}, // 요청에 포함할 데이터를 지정, 여기서는 "detail" 파라미터에 answer 값을 전달
					success: function (data) { // 서버로부터 받은 데이터를 showArea에 추가하여 FAQ 내용을 표시
						let str = data.detail + "<br>";
						showArea.append(str);
					},
					error: function () {
						showArea.html("<b>에러 발생</b>");
					}
				});
				showArea.toggle(); // 클릭할 때마다 열고 닫기 토글
			});
		});
	</script>
</head>

<body>
	<h3>자주 묻는 질문</h3>
	<table border="1" style="width: 99%;">
		<tr>
			<td colspan="3">
				<form action="/searchfaq?searchpage=1" method="post" style="text-align: right;">
					검색 대상 : 
					<select name="searchName">
						<option value="faq_category" selected>카테고리</option>
						<option value="faq_question">제목</option>
					</select>
					<input type="text" name="searchValue">
					<input type="submit" value="검 색">
				</form>
			</td>
		</tr>
		<tr>
			<th style="width: 10%;">번호</th>
			<th style="width: 15%;">카테고리</th>
			<th style="width: 75%;">제목</th>
		</tr>
	</table>
	<th:block th:if="${faq != null and faq.size() > 0}">
		<table border="1" style="width: 99%; text-align: center;" th:each="data : ${faq}" class="faq"
			th:data-answer="${data.faq_answer}" th:data-show-id="'show' + ${data.faq_no}">
			<!-- th:data-answer="${data.faq_answer}" : Thymeleaf의 th:data-* 속성을 사용하여 각 행에 FAQ 답변(faq_answer) 데이터를 data-answer 속성으로 설정, 
				 이렇게 함으로써 JavaScript 코드에서 FAQ 항목을 클릭할 때 해당 답변을 가져올 수 있다 
				 
				 th:data-show-id="'show' + ${data.faq_no}": FAQ 항목을 클릭할 때 해당 답변을 표시할 영역의 ID를 동적으로 생성, 
				 FAQ 번호(faq_no)를 사용하여 "show" 접두사를 붙이고, 이를 data-show-id 속성으로 설정, 이것은 JavaScript 코드에서 FAQ 항목과 해당 답변 영역을 매핑하는 데 사용-->		
			<tr>
				<td th:text="${data.faq_no}" style="width: 10%;"></td>
				<td th:text="${data.faq_category}" style="width: 15%;"></td>
				<td th:text="${data.faq_question}" style="width: 75%; text-align: left; padding-left: 5%"></td>
			</tr>
			<tr>
				<td colspan="3" style="text-align: left; padding-left: 10%">
					<div th:id="'show' + ${data.faq_no}" style="display: none;"></div>
					<!-- display: none; 스타일은 해당 요소를 화면에 표시하지 않으며 숨긴 상태로 시작, FAQ 내용을 처음에는 숨긴 상태로 유지하려는 목적 -->
				</td>
			</tr>
		</table>
	</th:block>	
	<table style="margin-top: 20px;">
        <tr style="text-align: center;">
            <td colspan="5">
                <th:block th:each="num : ${#numbers.sequence(1, pagesu)}">
                    <th:span th:if="${num == page}">
                        <b th:text="${num}">num 표시(현재 페이지는 링크를 걸지 않음)</b>
                    </th:span>
                    <th:span th:if="${num != page}">
                        <a th:href="@{/faq(page=${num})}" th:text="${num}">num 표시</a>
                    </th:span>
                </th:block>
            </td>
        </tr>
    </table>
</body>

</html>